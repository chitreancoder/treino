---
interface Props {
  name: string;
  sets: string;
  targetKg: number | null;
  actualKg?: number | null;
  done?: boolean;
  feeling?: string;
  notes?: string;
  repsCompleted?: string;
  lastWeekKg?: number | null;
}

const { name, sets, targetKg, actualKg, done, feeling, notes, repsCompleted, lastWeekKg } = Astro.props;

// Determine status
const isPending = done === undefined;
const isSkipped = done === false;
const isComplete = done === true;

// Did they beat the target?
const beatTarget = actualKg && targetKg && actualKg > targetKg;
const metTarget = actualKg && targetKg && actualKg === targetKg;
const missedTarget = actualKg && targetKg && actualKg < targetKg;

// Comparison vs last week
const vsLastWeek = actualKg && lastWeekKg ? actualKg - lastWeekKg : null;
const improvedVsLastWeek = vsLastWeek && vsLastWeek > 0;
const sameAsLastWeek = vsLastWeek === 0;
const declinedVsLastWeek = vsLastWeek && vsLastWeek < 0;
---

<div class={`
  relative p-4 rounded-xl border
  ${isComplete ? 'bg-[var(--color-card)] border-[var(--color-border)]' : ''}
  ${isPending ? 'bg-[var(--color-card)] border-[var(--color-amber)]' : ''}
  ${isSkipped ? 'bg-[var(--color-card)] border-[var(--color-red)]' : ''}
`}>
  <!-- Status indicator -->
  <div class="absolute top-4 right-4">
    {isComplete && (
      <div class={`w-6 h-6 rounded-full flex items-center justify-center ${beatTarget ? 'bg-lime text-black' : 'bg-[var(--color-border)] text-[var(--color-text-muted)]'}`}>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" />
        </svg>
      </div>
    )}
    {isPending && (
      <div class="w-6 h-6 rounded-full border-2 border-[var(--color-amber)] border-dashed flex items-center justify-center">
        <div class="w-2 h-2 rounded-full bg-[var(--color-amber)]"></div>
      </div>
    )}
    {isSkipped && (
      <div class="w-6 h-6 rounded-full bg-[var(--color-red)]/20 flex items-center justify-center">
        <svg class="w-4 h-4 text-[var(--color-red)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7" />
        </svg>
      </div>
    )}
  </div>

  <!-- Exercise name -->
  <h3 class={`font-display text-xl pr-8 ${isSkipped ? 'text-[var(--color-text-muted)] line-through' : 'text-[var(--color-text)]'}`}>
    {name}
  </h3>

  <!-- Sets -->
  <p class="font-mono text-sm text-[var(--color-text-muted)] mt-1">
    {sets}
    {repsCompleted && <span class="text-[var(--color-text-dim)]"> → {repsCompleted}</span>}
  </p>

  <!-- Weight comparison -->
  {targetKg && (
    <div class="mt-3 flex items-baseline gap-2">
      <span class="font-mono text-sm text-[var(--color-text-dim)]">Target:</span>
      <span class="font-mono text-lg text-[var(--color-text-muted)]">{targetKg}kg</span>

      {actualKg && (
        <>
          <span class="text-[var(--color-text-dim)]">→</span>
          <span class={`font-mono text-lg font-semibold ${beatTarget ? 'text-lime text-glow-lime' : ''} ${metTarget ? 'text-[var(--color-text)]' : ''} ${missedTarget ? 'text-[var(--color-amber)]' : ''}`}>
            {actualKg}kg
          </span>
          {beatTarget && (
            <span class="font-mono text-sm text-lime">+{actualKg - targetKg}kg</span>
          )}
        </>
      )}
    </div>
  )}

  <!-- Last week comparison -->
  {lastWeekKg && isComplete && (
    <div class="mt-2 flex items-center gap-2">
      <span class="font-mono text-xs text-[var(--color-text-dim)]">vs last week:</span>
      {improvedVsLastWeek && (
        <span class="font-mono text-xs text-lime flex items-center gap-1">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
          </svg>
          +{vsLastWeek}kg
        </span>
      )}
      {sameAsLastWeek && (
        <span class="font-mono text-xs text-[var(--color-text-muted)]">=</span>
      )}
      {declinedVsLastWeek && (
        <span class="font-mono text-xs text-[var(--color-amber)] flex items-center gap-1">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
          {vsLastWeek}kg
        </span>
      )}
    </div>
  )}

  <!-- Feeling -->
  {feeling && (
    <p class="mt-2 text-sm text-[var(--color-text-muted)] italic">
      "{feeling}"
    </p>
  )}

  <!-- Notes (for planned exercises) -->
  {notes && isPending && (
    <p class="mt-2 text-xs text-[var(--color-text-dim)]">
      Note: {notes}
    </p>
  )}
</div>
